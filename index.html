<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <!-- TODO update the title according to the selected options -->
    <title>1337</title><style type="text/css">body{
margin:40px auto;
max-width:650px;
line-height:1.6;
font-size:18px;
color:#eee;
background-color:#111;
padding:0 10px
}
textarea, output, button, select {
color:#eee;
background-color:#111;
}
label {
  margin-right: 1em;
}
</style>
</head>

<body>
  <form id="controls">
    <!-- Elements added here at runtime -->
  </form>
  <div>
    <textarea id="input" placeholder="type something in here" rows="8" cols="80"></textarea>
  </div>
  <div>
    <pre id="output"></pre>
  </div>
</body>

<script type="text/javascript">
  const controlsElement = document.getElementById("controls");

  const appendCheckbox = ({id, checked, name, replacement}) => {
    const checkbox = document.createElement("input");
    checkbox.id = id;
    checkbox.type = "checkbox";
    checkbox.checked = checked;

    controlsElement.appendChild(checkbox);

    const label = document.createElement("label");
    label.htmlFor = id;
    label.textContent = name || id;

    controlsElement.appendChild(label);

    return {checkbox, replacement};
  };

  const controls = [
    appendCheckbox({
        id: "you to u",
        checked: true,
        // Only replace "you" with "u" when it's the start of the string, or
        // there's whitespace before it, and there's either whitespace or
        // punctuation, or the end of the string after it.
        replacement: [/(^|\s)you([\s,\.!?'"]|$)/gi, "$1u$2"],
    }),
    appendCheckbox({
        id: "l to 1",
        checked: true,
        replacement: [/l/gi, "1"]
    }),
    appendCheckbox({
        id: "i to 1",
        checked: true,
        replacement: [/i/gi, "1"]
    }),
    appendCheckbox({
        id: "a to 4",
        checked: true,
        replacement: [/a/gi, "4"]
    }),
    appendCheckbox({
        id: "e to 3",
        checked: true,
        replacement: [/e/gi, "3"]
    }),
    appendCheckbox({
        id: "o to 0",
        checked: true,
        replacement: [/o/gi, "0"]
    }),
    appendCheckbox({
        id: "t to 7",
        checked: true,
        replacement: [/t/gi, "7"]
    }),
  ];

  let replacements = [];

  const render = () => {
    let s = input.value

    for ([from, to] of replacements) {
      s = s.replaceAll(from, to)
    }

    output.innerText = s
  };

  const sync = () => {
    replacements = []

    for (control of controls) {
      if (control.checkbox.checked) {
        replacements.push(control.replacement);
      }
    }

    render();
  };

  controlsElement.addEventListener("change", sync);

  const input = document.getElementById("input");
  const output = document.getElementById("output");

  input.addEventListener("input", render);

  sync();
</script>

</html>
